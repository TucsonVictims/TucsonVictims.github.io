<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Троллус — чистый рофл</title>
<style>
  body{font-family:Inter,system-ui,Segoe UI,Arial;background:#0b0f1a;color:#e6eef8;display:flex;flex-direction:column;align-items:center;padding:28px}
  .card{background:#0f1724;padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,.6);max-width:760px;width:100%}
  h1{margin:0 0 12px}
  .btn{background:#ff6b6b;color:#111;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
  .small{font-size:13px;color:#9fb2d8}
  #log{margin-top:14px;min-height:80px}
  .msg{background:#081426;padding:10px;border-radius:8px;margin:8px 0}
</style>
</head>
<body>
  <div class="card">
    <h1>Троллус — harmless trolling</h1>
    <p class="small">Нажимай кнопки — смеёмся. Никаких личных данных.</p>

    <div style="display:flex;gap:10px;margin-top:12px">
      <button id="panicBtn" class="btn">Паника!</button>
      <button id="notBtn" class="btn">НЕ Нажимай</button>
      <button id="rickBtn" class="btn">Открыть «важное»</button>
    </div>

    <div id="log" class="small"></div>

    <hr style="margin:18px 0;border:none;border-top:1px solid #132033">

    <div>
      <h3 style="margin:0 0 8px">Анонимные confessions (только для рофла)</h3>
      <form id="confForm" style="display:flex;gap:8px">
        <input id="confText" placeholder="Напиши что-то смешное..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #123" />
        <button class="btn" type="submit">Отправить</button>
      </form>
      <div id="feed"></div>
    </div>
  </div>

<script>
/* === Настройки === */
const SHEETDB_ENDPOINT = 'https://sheetdb.io/api/v1/ul1a4ghd0iqpg';

/* Утилиты */
const el = id => document.getElementById(id);
function log(txt){ const d = document.createElement('div'); d.className='msg'; d.textContent = txt; el('log').prepend(d); }

/* Паника — просто меняем цвета и показываем текст */
el('panicBtn').addEventListener('click', ()=> {
  document.body.style.transition = 'background 0.6s';
  document.body.style.background = '#2b0000';
  log('Срочно! Все коты ушли в офлайн. Успокойтесь.');
  setTimeout(()=>{ document.body.style.background = '#0b0f1a'; log('Шутка. Все в порядке.'); }, 3500);
});

/* Не нажимать — конфетти + звук + шутка */
el('notBtn').addEventListener('click', ()=> {
  log('Ты всё-таки нажал... держи конфетти!');
  // простое конфетти
  for(let i=0;i<40;i++){
    const p = document.createElement('div');
    p.textContent = '??';
    p.style.position='fixed';
    p.style.left = Math.random()*100 + '%';
    p.style.top = (Math.random()*30+5)+'%';
    p.style.fontSize = (10+Math.random()*30)+'px';
    p.style.opacity = '0.9';
    document.body.appendChild(p);
    setTimeout(()=>p.remove(),2500);
  }
});

/* Рикролл — открываем модальное с видео */
el('rickBtn').addEventListener('click', ()=>{
  const modal = document.createElement('div');
  modal.style.position='fixed'; modal.style.inset=0; modal.style.background='rgba(0,0,0,.85)';
  modal.style.display='flex'; modal.style.alignItems='center'; modal.style.justifyContent='center';
  modal.innerHTML = `<div style="max-width:80%;width:720px;background:#071426;padding:16px;border-radius:12px">
    <h3 style="margin:0 0 8px">Важное объявление</h3>
    <div style="position:relative;padding-top:56.25%"><iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1" style="position:absolute;left:0;top:0;width:100%;height:100%" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>
    <p style="margin-top:8px"><button id="closeRick" class="btn">Закрыть</button></p>
  </div>`;
  document.body.appendChild(modal);
  modal.querySelector('#closeRick').addEventListener('click', ()=> modal.remove());
});

/* Confessions: загрузка и отправка (с простым фильтром) */
async function loadFeed(){
  const feed = el('feed'); feed.innerHTML = '';
  if(!SHEETDB_ENDPOINT){ feed.innerHTML = '<div class="small">Feed отключён (нет endpoint)</div>'; return }
  try{
    const r = await fetch(SHEETDB_ENDPOINT + '/search?limit=10&order_by=-_row'); // пример SheetDB query
    const data = await r.json();
    data.forEach(item=>{
      const d = document.createElement('div'); d.className='msg'; d.textContent = item.text || '(пусто)';
      feed.appendChild(d);
    });
  } catch(e){
    feed.innerHTML = '<div class="small">Не удалось загрузить feed.</div>';
  }
}
loadFeed();

el('confForm').addEventListener('submit', async (ev)=>{
  ev.preventDefault();
  const text = el('confText').value.trim();
  if(!text) return;
  // Простой фильтр: убираем явную ненормативку (примитивно)
  const bad = /(fuck|бля|сука|идиот|пизд)/i;
  if(bad.test(text)){ alert('Слишком грубо. Сделай мягче.'); return; }

  if(!SHEETDB_ENDPOINT){
    log('Отправка в таблицу пропущена (SHEETDB_ENDPOINT пуст). Твой текст: ' + text);
    el('confText').value=''; return;
  }

  try{
    await fetch(SHEETDB_ENDPOINT, {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ data: [{ text }] })
    });
    log('Отправлено анонимно: ' + text.slice(0,60));
    el('confText').value='';
    setTimeout(loadFeed,800);
  } catch(e){
    alert('Ошибка отправки');
  }
});
</script>
